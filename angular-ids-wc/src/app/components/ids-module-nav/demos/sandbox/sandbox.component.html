<!-- Template for "depth-2" and below accordion items -->
<ng-template #recursiveAccordionSubItemList let-list="list">
  <ids-accordion-panel slot="content" color-variant="sub-module-nav" *ngFor="let item of list">
    <ids-module-nav-item slot="header" color-variant="sub-module-nav" [attr.display-mode]="this.displayMode"
      icon="{{item.icon}}" expander-type="plus-minus" id="{{getItemIdFromText(item.text)}}">
      <ids-text font-size="14" overflow="ellipsis">{{item.text}}</ids-text>
    </ids-module-nav-item>
    <ng-container *ngTemplateOutlet="recursiveAccordionSubItemList; context:{ list: item.children }"></ng-container>
  </ids-accordion-panel>
</ng-template>

<!-- Template for "depth-1" accordion items -->
<ng-template #recursiveAccordionItemList let-list="list">
  <ids-accordion-panel color-variant="module-nav" *ngFor="let item of list">
    <ids-module-nav-item slot="header" color-variant="module-nav" [attr.display-mode]="this.displayMode"
      icon="{{item.icon}}" id="{{getItemIdFromText(item.text)}}">
      <ids-text font-size="16" overflow="ellipsis">{{item.text}}</ids-text>
    </ids-module-nav-item>
    <ng-container *ngTemplateOutlet="recursiveAccordionSubItemList; context:{ list: item.children }"></ng-container>
  </ids-accordion-panel>
</ng-template>

<ids-container role="main" padding="0" hidden>
  <ids-module-nav 
    #moduleNavRef 
    id="module-nav" 
    displayMode="{{displayMode}}"
    responsive="{{responsive}}"
    (displaymodechange)="handleDisplayModeChange($event)">
    <ids-module-nav-bar 
      #moduleNavBarRef 
      filterable="{{filterable}}" 
      pinned="{{pinned}}">
      <ids-module-nav-switcher slot="role-switcher">
        @if (this.roleSwitcherData.length) {
          <ids-module-nav-button id="module-nav-button">
            <ids-icon
              icon="{{roleSwitcherSelectedItem.icon}}"
              height="32"
              width="32"
              viewBox="0 0 32 32"
              [attr.stroke]="'none'"></ids-icon>
            <ids-text audible>{{roleSwitcherSelectedItem.text}}</ids-text>
          </ids-module-nav-button>
          <ids-dropdown 
            id="module-nav-role-dropdown"
            dropdown-icon="expand-all"
            color-variant="module-nav"
            label="Select Role"
            show-list-item-icon="false"
            value="{{roleSwitcherSelectedItem.value}}"
            [ngModel]="roleSwitcherSelectedItem.value"
            (selected)="handleRoleSwitcherSelected($event)">
            <ids-list-box *ngIf="this.roleSwitcherData.length">
              <ids-list-box-option 
                *ngFor="let item of this.roleSwitcherData" 
                value="{{item.value}}" 
                id="{{item.value}}"
                [class.is-selected]="item.value === this.roleSwitcherSelectedItem.value">
                <ids-icon icon="{{item.icon}}" height="32" width="32" viewBox="0 0 32 32" [attr.stroke]="'none'"></ids-icon>
                <span>{{item.text}}</span>
              </ids-list-box-option>
            </ids-list-box>
          </ids-dropdown>
        }
      </ids-module-nav-switcher>

      <ids-search-field id="search" clearable color-variant="module-nav" label="Module Nav Search"
        label-state="collapsed" no-margins placeholder="Search" size="full" slot="search"></ids-search-field>

      <!-- Main Content (Accordion Navigation) -->
      <ids-accordion
        #moduleNavAccordionRef
        [attr.allow-one-pane]="oneAccordionPane">
        <!-- Main Section -->
        <ids-accordion-section slot="" grow>
          <ng-container *ngTemplateOutlet="recursiveAccordionItemList; context:{ list: accordionItems }"></ng-container>
        </ids-accordion-section>
      </ids-accordion>

      <!-- Pinned Footer Section -->
      <ids-accordion slot="footer">
        <ids-accordion-section pinned>
          <ids-accordion-panel>
            <ids-module-nav-item id="item-document" slot="header" icon="document">
              <ids-text font-size="16">Documents</ids-text>
            </ids-module-nav-item>
          </ids-accordion-panel>
          <ids-accordion-panel>
            <ids-module-nav-item id="item-reports" slot="header" icon="report">
              <ids-text font-size="16">Reports</ids-text>
            </ids-module-nav-item>
          </ids-accordion-panel>
          <ids-accordion-panel>
            <ids-module-nav-item id="item-notification" slot="header" icon="notification">
              <ids-text font-size="16">Notification</ids-text>
            </ids-module-nav-item>
          </ids-accordion-panel>
        </ids-accordion-section>
      </ids-accordion>

      <ids-module-nav-settings slot="settings" role="button" icon="settings" id="module-nav-settings-btn"
        menu="module-nav-settings-menu" color-variant="module-nav" content-align="start" no-margins no-ripple>
        <ids-text>Settings</ids-text>
      </ids-module-nav-settings>
      <ids-popup-menu id="module-nav-settings-menu" target="#module-nav-settings-btn" trigger-type="click"
        slot="settings">
        @if (this.settingsData.length) {
          <ids-menu-group>
            @for (item of this.settingsData; let i = $index; track i) {
              @switch (item.type) {
                @case ('separator') {
                  <ids-separator></ids-separator>
                }
                @default {
                  <ids-menu-item 
                    icon="{{item.icon}}" 
                    value="{{item.value}}">{{item.text}}</ids-menu-item>
                }
              }
            }
          </ids-menu-group>
        }
      </ids-popup-menu>

    </ids-module-nav-bar>

    <ids-module-nav-content
      #moduleNavContentRef
      [attr.offset-content]="offsetContent">
      <!-- Page Header -->
      <ids-header>
        <ids-toolbar>
          <ids-toolbar-section type="button">
            <ids-button 
              #moduleNavTriggerBtnRef 
              id="module-nav-trigger" 
              icon="menu"
              (click)="handleHamburgerButtonClick()">
              <span class="audible">Open Module Nav</span>
            </ids-button>
          </ids-toolbar-section>
          <ids-toolbar-section type="title">
            <ids-text font-size="20" type="h1">Module Nav Sandbox</ids-text>
          </ids-toolbar-section>
          <ids-toolbar-section align="end" type="button">
            <ids-theme-switcher mode="light"></ids-theme-switcher>
          </ids-toolbar-section>
        </ids-toolbar>
      </ids-header>

      <!-- Page Body -->
      <ids-layout-grid auto-fit="true" padding="md">
        <ids-text font-size="12" type="h1">General Settings</ids-text>
      </ids-layout-grid>
      <ids-layout-grid gap="md" padding-x="md">
        <ids-layout-grid-cell>
          <ids-checkbox 
            id="one-accordion-pane" 
            label="Expand one IdsAccordionPanel at a time"
            [(ngModel)]="oneAccordionPane"
            (change)="handleAllowOnePaneChange($event)"></ids-checkbox>
          <ids-checkbox 
            id="is-filterable" 
            label="Enable Filtering"
            [(ngModel)]="filterable"
            (change)="handleFilteringChange($event)"
            checked></ids-checkbox>
          <ids-checkbox 
            id="pin-sections" 
            label="Pin Favorites to the bottom"
            [(ngModel)]="pinned"
            (change)="handlePinnedChange($event)"
            checked></ids-checkbox>
        </ids-layout-grid-cell>
      </ids-layout-grid>

      <ids-layout-grid auto-fit="true" padding="md">
        <ids-text font-size="12" type="h1">Display</ids-text>
      </ids-layout-grid>
      <ids-layout-grid gap="md" padding-x="md">
        <ids-layout-grid-cell>
          <ids-checkbox 
            id="is-responsive" 
            label="Enable Responsive (Mobile) Behavior"
            (change)="handleResponsiveChange($event)"
            [(ngModel)]="responsive"
            checked></ids-checkbox>
          <ids-checkbox
            #offsetContentCheckRef 
            id="use-offset-content" 
            label="Push content out from underneath IdsModuleNavBar while expanded"
            (change)="handleOffsetContentChange($event)"
            [(ngModel)]="offsetContent"
            checked
            disabled></ids-checkbox>
          <ids-dropdown 
            #displayModeDropdownRef
            id="dd-display-mode-setting"
            label="Display Mode" 
            value="{{getDisplayModeDropdownValue(displayMode)}}"
            [(ngModel)]="displayMode"
            (selected)="handleDisplayModeDropdownChange($event)"
            dirty-tracker="true" 
            disabled>
            <ids-list-box>
              <ids-list-box-option id="dd-display-mode-false" value="">Hidden (false)</ids-list-box-option>
              <ids-list-box-option id="dd-display-mode-collapsed" value="collapsed">Collapsed</ids-list-box-option>
              <ids-list-box-option id="dd-display-mode-expanded" value="expanded">Expanded</ids-list-box-option>
            </ids-list-box>
          </ids-dropdown>
        </ids-layout-grid-cell>
      </ids-layout-grid>

      <ids-layout-grid auto-fit="true" padding="md">
        <ids-text font-size="12" type="h1">Dataset</ids-text>
      </ids-layout-grid>
      <ids-layout-grid auto-fit="true" gap="md" padding-x="md">
        <ids-layout-grid-cell>
          <ids-radio-group 
            #datasetRadioRef
            id="radio-dataset"
            label="Accordion Dataset"
            value="{{datasetName}}"
            [(ngModel)]="datasetName"
            (change)="handleDatasetChange($event)">
            <ids-radio value="default" label="Default (Module Nav)" checked="true"></ids-radio>
            <ids-radio value="nested-with-icons" label="Nested with icons"></ids-radio>
            <ids-radio value="nested-no-icons" label="Nested without icons"></ids-radio>
          </ids-radio-group>
        </ids-layout-grid-cell>
      </ids-layout-grid>
    </ids-module-nav-content>
  </ids-module-nav>
</ids-container>